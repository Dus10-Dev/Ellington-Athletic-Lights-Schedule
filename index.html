<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Field Light Schedule</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        h1 {
            text-align: center;
            margin: 20px 0;
            color: #343a40;
        }
        table {
            margin: 0 auto;
            width: 90%;
        }
        th, td {
            padding: 15px;
            text-align: center;
        }
        th {
            background-color: #007bff;
            color: white;
        }
        .footer {
            text-align: center;
            margin: 50px 0;
            color: #6c757d;
        }
        .filters {
            margin: 20px auto;
            width: 90%;
            display: flex;
            justify-content: space-between;
        }
        select {
            padding: 10px;
            width: 30%;
        }
    </style>
</head>
<body>

    <h1>Ellington & Robert Tedford Memorial Park Light Schedule</h1>

    <!-- Filters Section -->
    <div class="filters">
        <select id="facilityFilter">
            <option value="">Filter by Facility</option>
        </select>
        <select id="fieldFilter">
            <option value="">Filter by Field</option>
        </select>
        <select id="dateFilter">
            <option value="">Filter by Date</option>
        </select>
    </div>

    <div class="container">
        <table class="table table-striped table-bordered">
            <thead>
                <tr>
                    <th>Facility</th>
                    <th>Field</th>
                    <th>Date</th>
                    <th>Lights On</th>
                    <th>Lights Off</th>
                </tr>
            </thead>
            <tbody id="schedule-table">
                <!-- Table rows will be dynamically inserted here -->
            </tbody>
        </table>
    </div>

    <div class="footer">
        <p>Â© 2024 Ellington Sports Facility Schedule | All rights reserved.</p>
    </div>

    <!-- Papa Parse CDN for CSV parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script>
        const csvFilePath = 'schedule.csv';  // Path to the CSV file
        let scheduleData = [];  // Will hold the parsed data

        // Load and parse the CSV
        function loadSchedule() {
            Papa.parse(csvFilePath, {
                download: true,
                header: true,
                complete: function(results) {
                    scheduleData = results.data;
                    populateFilters();
                    displaySchedule();
                }
            });
        }

        // Function to populate filter dropdowns
        function populateFilters() {
            const facilities = [...new Set(scheduleData.map(row => row.Facility))].sort();
            const fields = [...new Set(scheduleData.map(row => row.Field))].sort();
            const dates = [...new Set(scheduleData.map(row => row.Date))].sort();

            populateDropdown('facilityFilter', facilities);
            populateDropdown('fieldFilter', fields);
            populateDropdown('dateFilter', dates);
        }

        // Helper function to populate a dropdown
        function populateDropdown(filterId, values) {
            const filterElement = document.getElementById(filterId);
            values.forEach(value => {
                const option = document.createElement('option');
                option.value = value;
                option.text = value;
                filterElement.appendChild(option);
            });
        }

        // Function to display the schedule in the table
        function displaySchedule() {
            const facilityFilter = document.getElementById('facilityFilter').value;
            const fieldFilter = document.getElementById('fieldFilter').value;
            const dateFilter = document.getElementById('dateFilter').value;

            const filteredData = scheduleData.filter(row => {
                return (!facilityFilter || row.Facility === facilityFilter) &&
                       (!fieldFilter || row.Field === fieldFilter) &&
                       (!dateFilter || row.Date === dateFilter);
            });

            const sortedData = filteredData.sort((a, b) => new Date(a.Date) - new Date(b.Date));

            const tableBody = document.getElementById('schedule-table');
            let tableRows = '';

            sortedData.forEach(row => {
                tableRows += `<tr>
                                <td>${row.Facility}</td>
                                <td>${row.Field}</td>
                                <td>${row.Date}</td>
                                <td>${formatTime(row['Lights On'], '12:01 AM')}</td>
                                <td>${formatTime(row['Lights Off'], '11:59 PM')}</td>
                              </tr>`;
            });

            tableBody.innerHTML = tableRows;
        }

        // Function to format time to ensure it adheres to the time window (12:01 AM to 11:59 PM)
        function formatTime(time, fallbackTime) {
            return time || fallbackTime;
        }

        // Event listeners for filtering
        document.getElementById('facilityFilter').addEventListener('change', displaySchedule);
        document.getElementById('fieldFilter').addEventListener('change', displaySchedule);
        document.getElementById('dateFilter').addEventListener('change', displaySchedule);

        // Load schedule on page load
        window.onload = loadSchedule;
    </script>

</body>
</html>
